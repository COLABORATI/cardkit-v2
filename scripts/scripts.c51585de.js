"use strict";angular.module("cardkitApp",["ngAnimate","ngCookies","ngResource","ngRoute","ngSanitize","ngTouch","colorpicker.module","draganddrop","colorpicker.module","ui.router"]).config(["$stateProvider","$urlRouterProvider",function(a,b){b.otherwise("/"),a.state("index",{url:"/",controller:"MainCtrl",templateUrl:"views/main.html",resolve:{themeConfig:["themeConfigProvider",function(a){return a}]}})}]),angular.module("cardkitApp").controller("MainCtrl",["$scope","saveSvgAsPng","themeConfig",function(a,b,c){function d(b,c){var d=new FileReader;d.onload=function(){a.config.svg.elements[c].src=d.result,a.$apply()},d.readAsDataURL(b)}function e(a){return a.stopPropagation(),a.preventDefault(),a.dataTransfer||null}a.config={sizes:[{name:"Facebook",width:800,height:370},{name:"Twitter",width:650,height:320},{name:"Video",width:640,height:360}],themes:c,output:{scale:2,editable:{scale:!0}},svg:{canvas:{height:function(){return a.size.height},width:function(){return a.size.width},fill:function(){return a.theme.background}},elements:[{name:"Image",type:"image",width:200,height:function(){return this.width},src:"",opacity:1,x:"50%",y:"50%",preserveAspectRatio:"xMinYMin meet",draggable:!0,defaultFilter:"",editable:{src:!0,width:!0,opacity:!0,filters:["Sepia","Grayscale","Saturate","Invert","Blur"]}},{name:"Logo",type:"image",width:250,height:function(){return this.width},src:function(){return a.theme.logoSrc},opacity:1,x:"330",y:"300",textAnchor:"end",preserveAspectRatio:"xMinYMin meet",editable:!1,draggable:!0},{name:"Credit",type:"text",text:"Credit: Insert name here",fill:function(){return a.theme.quote},fontSize:12,fontFamily:function(){return a.theme.headlineFont},textAnchor:"end",x:580,y:250,draggable:!0,editable:{text:!0,fontSize:{Small:12,Medium:18,Large:22,"Extra Large":36},fill:"picker"}},{type:"group",name:"Title",x:30,y:90,editable:!0,draggable:!0,elements:[{name:"Logo",type:"image",width:30,height:function(){return this.width},src:function(){return a.theme.logoSecondarySrc},opacity:1,x:20,y:37,preserveAspectRatio:"xMinYMin meet",editable:!1},{name:"Headline",type:"text",text:"I'm attached to the image on the left. \nEdit me and drag me around",fill:function(){return a.theme.quote},fontSize:"26",fontFamily:function(){return a.theme.headlineFont},textAnchor:"left",x:55,y:55,editable:{text:!0,fill:"picker"}}]}]}},"undefined"!=typeof a.config.themes&&(a.theme=a.config.themes.length>1?null:a.config.themes[0]),a.size=a.config.sizes.length>1?null:a.config.sizes[0],a.$watch("theme",function(){a.$broadcast("changeTheme")}),a.$watch("size",function(){a.$broadcast("changeSize")}),a.onDrop=function(a,b,c){var f=e(b);d(f.files[0],c)},a.removeImage=function(b){a.config.svg.elements[b].src=""},a.downloadSvg=function(){b(document.getElementById("snap-svg"),"image.png",{scale:a.config.output.scale})}}]),angular.module("cardkitApp").service("snapSVG",["$window",function(a){return a.Snap}]),angular.module("cardkitApp").directive("snapSvg",["snapSVG",function(a){return{template:'<svg id="snap-svg"></svg>',restrict:"E",scope:{svgConfig:"=",svgTheme:"="},link:function(b,c){function d(a){var b={};for(var c in a)switch(typeof a[c]){case"function":b[c]=a[c]();break;default:b[c]=a[c]}return b}function e(){m={Sepia:j.paper.filter(a.filter.sepia(1)).attr({width:4*k.width+"px",height:4*k.height+"px"}),Grayscale:j.paper.filter(a.filter.grayscale(1)).attr({width:4*k.width+"px",height:4*k.height+"px"}),Saturate:j.paper.filter(a.filter.saturate(.5)).attr({width:4*k.width+"px",height:4*k.height+"px"}),Invert:j.paper.filter(a.filter.invert(1)).attr({width:4*k.width+"px",height:4*k.height+"px"}),Blur:j.paper.filter(a.filter.blur(4,4)).attr({width:4*k.width+"px",height:4*k.height+"px"})}}function f(a){var b;switch(a=d(a),a.type){case"text":b=j.text(a.x,a.y);break;case"image":b=j.image(a.src,a.x,a.y,a.width,a.height);break;case"rect":b=j.rect(a.x,a.y,a.width,a.height,0,0);break;case"circle":break;case"group":var c;b="",angular.forEach(a.elements,function(a,d){c=f(a),g(c,a),0===d?b=j.group(c):b.group(c)});break;default:return!1}return"undefined"!=typeof a.defaultFilter&&b.attr(""!==a.defaultFilter?{filter:m[a.defaultFilter]}:{filter:""}),b}function g(a,b){var c=d(b),e=c;return delete e.$$hashKey,"text"===e.type&&(e.text=e.text.split("\n")),a.attr(e),"text"===e.type&&a.selectAll("tspan").forEach(function(a,b){a.attr({x:e.x,y:e.y+e.fontSize*b})}),a}function h(){var a=d(b.svgConfig.canvas);j.attr({viewBox:"0, 0, "+a.width+", "+a.height,"data-width":a.width,"data-height":a.height}),g(l,b.svgConfig.canvas);var c;angular.forEach(b.svgConfig.elements,function(a,d){if("undefined"!=typeof o[d]){if(n=o[d],"image"===n.type){c=n.matrix;var e=f(b.svgConfig.elements[d]);if(e===!1)return;n.after(e),e.transform(c),n.remove(),n=e,o[d]=n}if("g"===n.type){if(c=n.matrix,n.remove(),n=f(b.svgConfig.elements[d]),n===!1)return;n.transform(c),o[d]=n}}else{if(n=f(a),n===!1)return;o.push(n)}var h=a;delete h.$$hashKey,g(n,a),a.draggable===!0&&(n.undrag(),n.altDrag())})}var i=angular.fromJson(b.svgConfig);a.plugin(function(a,b){b.prototype.altDrag=function(){return this.drag(d,c,e),this};var c=function(){this.data("ot",this.transform().local)},d=function(a,b){var c,d,e=this.transform().diffMatrix.invert();e.e=e.f=0,c=e.x(a,b),d=e.y(a,b),this.transform(this.data("ot")+"t"+[c,d])},e=function(){}});var j=a(c[0].children[0]);j.attr({height:"100%",width:"100%"});var k=d(i.canvas),l=j.rect(0,0,k.width,k.height,0,0).attr(k);k.draggable===!0&&l.altDrag();var m;e();var n,o=[];b.$watch("svgConfig",h,!0),b.$on("changeTheme",h),b.$on("changeSize",h),b.$on("changeSize",e)}}}]),angular.module("cardkitApp").service("saveSvgAsPng",["$window",function(a){return a.saveSvgAsPng}]),angular.module("cardkitApp").directive("fixedScroll",["$window",function(a){return function(b,c){var d=c.offset().top-20;angular.element(a).bind("scroll",function(){angular.element(a).scrollTop()>=d?c.addClass("fixed"):c.removeClass("fixed")})}}]),angular.module("cardkitApp").provider("themeConfigProvider",function(){return{$get:["$http","$q",function(a,b){var c=a.get("themes.config.json")["catch"](function(a){return 404===a.status?[]:b.reject(a)});return b.all([c]).then(function(a){return a[0].data})}]}});